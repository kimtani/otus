### Лабораторная работа. Развертывание коммутируемой сети в резервными каналами

![](http://joxi.ru/v29zxn8HRyq35A.jpg)


#### Таблица адресации:

 | Устройство | Интерфейс | IP- адрес | Маска подсети | 
 | ------------- |:------------------:| -----:|-----:|
 | S1 | VLAN 1 | 192.168.1.1 | 255.255.255.0 | 
 | S2 | VLAN 1 | 192.168.1.2 |255.255.255.0|
 | S3 | VLAN 1 | 192.168.1.3 |255.255.255.0|

#### Цели:

#### Часть 1 Создание сети и настройка основных параметров устройства

#### Часть 2 Выбор корневого моста

#### Часть 3 Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов

#### Часть 4 Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

-------------------------------------

### Часть 1: Создание сети и настройка основных параметров устройства

В части 1 вам предстоит настроить топологию сети и основные параметры маршрутизаторов.

#### Шаг 1: Создайте сеть согласно топологии. Подключите устройства, как показано в топологии, и подсоедините необходимые кабели.

#### Шаг 2: Выполните инициализацию и перезагрузку коммутаторов.

#### Шаг 3: Настройте базовые параметры каждого коммутатора.

a.Отключите поиск DNS.

b.Присвойте имена устройствам в соответствии с топологией.

c.Назначьте class в качестве зашифрованного пароля доступа к привилегированному режиму.

d.Назначьте cisco в качестве паролей консоли и VTY и активируйте вход для консоли и VTY
каналов.

e.Настройте logging synchronous для консольного канала.

f.Настройте баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете
несанкционированного доступа.

g.Задайте IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.

h.Скопируйте текущую конфигурацию в файл загрузочной конфигурации.

a-h Для S1. S2 и S3 настроены аналогично 


```

Switch>en
Switch#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#line con 0
Switch(config-line)#logg sync
Switch(config-line)#exec-timeout 0 0
Switch(config-line)#exit
Switch(config)#exit
Switch#
%SYS-5-CONFIG_I: Configured from console by console

Switch#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#no ip domain-name
Switch(config)#hostname S1
S1(config)#enable secret class
S1(config)#line vty 0 4
S1(config-line)#password cisco
S1(config-line)#login
S1(config-line)#exit
S1(config)#banner motd *Unauthorized access is strictly prohibited*
S1(config)#int vlan 1
S1(config-if)#ip ad 192.168.1.1 255.255.255.0
S1(config-if)#exit
S1(config)#do copy run sta
Destination filename [startup-config]? 
Building configuration...
[OK]
S1(config)#

```

Шаг 4: Проверьте связь.

Проверьте способность компьютеров обмениваться эхо-запросами.

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2?

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3?

Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3?

Выполняйте отладку до тех пор, пока ответы на все вопросы не будут положительными.

Все запросы между коммутаторами выполнены успешно.

![](http://joxi.ru/DmB5Q0jUgMYXgr.jpg)
![](http://joxi.ru/L21qKdOUzbxXB2.jpg)
![](http://joxi.ru/v29zxn8HRowE0A.jpg)

-----------------------

### Часть 2: Определение корневого моста

#### Шаг 1: Отключите все порты на коммутаторах.

#### Шаг 2: Настройте подключенные порты в качестве транковых.

#### Шаг 3: Включите порты F0/2 и F0/4 на всех коммутаторах.

#### Шаг 4: Отобразите данные протокола spanning-tree.

![](http://joxi.ru/EA4GRZxCvQ6Q02.jpg)

S1

![](http://joxi.ru/BA0JLWltvnbW8m.jpg)

S2

![](http://joxi.ru/L21qKdOUzbjYW2.jpg)

S3

![](http://joxi.ru/1A503akTzXRV12.jpg)

1.В данной топологии корневым коммутатором является S1.

2. Приоритет по умолчанию у всех трех коммутаторов одинаковый, также они работают в одном VLAN, соответственно  третьей метрикой при выборе корневого моста является значение MAC-адрес устройств в топологии. Меньше MAC-адрес - выше приоритет. В данной топологии наименьшее значение MAC-адреса у коммутатора S3.

3. Корневыми портами на коммутаторе называются те порты, которые направлены в сторону корневого моста.

4. Назначенный порт - некорневой порт моста между сегментами сети, принимающий трафик из соответствующего сегмента. В каждом сегменте сети может быть только один назначенный порт. У корневого коммутатора все порты — назначенные.
5. Альтернативный порт, или заблокированный - порт, который не участвует в передаче трафика, но находится в состоянии прослушивания.
6.?

-------------------------------------

### Часть 3: Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов

* Часть 3 выполнена частично в Packet Tracer (визуализация карты), часть в Termilab

![](http://joxi.ru/5mdVO36iayDJGA.jpg)

#### Шаг 1:

Определите коммутатор с заблокированным портом.
При текущей конфигурации только один коммутатор может содержать заблокированный протоколом
STP порт. Выполните команду show spanning-tree на обоих коммутаторах некорневого моста.
В примере ниже протокол spanning-tree блокирует порт F0/4 на коммутаторе с самым высоким
идентификатором BID (S1).

*S1# show spanning-tree*

![](http://joxi.ru/DrlD893UGwLZ9r.jpg)

![](http://joxi.ru/Y2LO3EoiMj68Qm.jpg)


#### Шаг 2:

Измените стоимость порта.
Помимо заблокированного порта, единственным активным портом на этом коммутаторе является
порт, выделенный в качестве порта корневого моста. Уменьшите стоимость этого порта корневого
моста до 18, выполнив команду spanning-tree cost 18 режима конфигурации интерфейса.

```
S1(config)# interface f0/4
S1(config-if)# spanning-tree cost 18

```
![](http://joxi.ru/52a9aZDCg7MBq2.jpg)

![](http://joxi.ru/4AkD79RU0wdYPr.jpg)

Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт
и блокирует порт, который был назначенным портом на другом коммутаторе?

Изменилась стоимость порта, и произошел пересчет стоимости путей на других коммутаторах.

#### Шаг 3:
Просмотрите изменения протокола spanning-tree.
Повторно выполните команду show spanning-tree на обоих коммутаторах некорневого моста.
Обратите внимание, что ранее заблокированный порт (S1 – F0/2) теперь является назначенным
портом, и протокол spanning-tree теперь блокирует порт на другом коммутаторе некорневого моста
(S3 – F0/4).

```
S1# show spanning-tree

```

#### Шаг 4: Удалите изменения стоимости порта.

a.Выполните команду no spanning-tree cost 18 режима конфигурации интерфейса, чтобы удалить
запись стоимости, созданную ранее.

```
S1(config)# interface f0/4
S1(config-if)# no spanning-tree cost 18

```


b. Повторно выполните команду show spanning-tree, чтобы подтвердить, что протокол STP сбросил
порт на коммутаторе некорневого моста, вернув исходные настройки порта. Протоколу STP
требуется примерно 30 секунд, чтобы завершить процесс перевода порта.

![](http://joxi.ru/v29zxn8HRo8DjA.jpg)

### Часть 4: Наблюдение за процессом выбора протоколом STP порта,исходя из приоритета портов

a. Включите порты F0/1 и F0/3 на всех коммутаторах.

b. Подождите 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего
выполните команду show spanning-tree на коммутаторах некорневого моста. Обратите внимание,
что порт корневого моста переместился на порт с меньшим номером, связанный с коммутатором
корневого моста, и заблокировал предыдущий порт корневого моста.

```
S1# show spanning-tree

```
![](http://joxi.ru/p27jn3yUn1GMxm.jpg)

![](http://joxi.ru/v29zxn8HRo8VJA.jpg)

```
```
```
```
```
```
```
```
```
```
```
```
![](http://joxi.ru/p27jn3yUn1GMxm.jpg)

![]()
![]()

Вопросы для повторения
Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить
выбор порта?
_______________________________________________________________________________________
Если первое значение на двух портах одинаково, какое следующее значение будет использовать
протокол STP при выборе порта?
_______________________________________________________________________________________
Если оба значения на двух портах равны, каким будет следующее значение, которое использует
протокол STP при выборе порта?
_______________________________________________________________________________________
